<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Store Management System | Vidul BioMass</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c786c;
            --secondary-color: #004445;
            --accent-color: #f8b400;
            --light-color: #faf5e4;
            --dark-color: #333;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f5f5f5;
            color: var(--dark-color);
            overflow-x: hidden;
        }

        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            animation: gradientBG 15s ease infinite;
            background-size: 400% 400%;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .login-box {
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 400px;
            transform: translateY(0);
            transition: var(--transition);
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .login-box h2 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 120, 108, 0.2);
        }

        .btn {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            font-weight: 500;
        }

        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .error-message {
            color: var(--danger-color);
            margin-top: 1rem;
            text-align: center;
            font-size: 0.9rem;
        }

        /* Main Layout */
        .main-container {
            display: none;
            min-height: 100vh;
        }

        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .header h2 {
            font-size: 1rem;
            font-weight: 400;
            opacity: 0.9;
        }

        .logout-btn {
            background-color: var(--accent-color);
            color: var(--dark-color);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .logout-btn:hover {
            background-color: #e0a800;
        }

        .content-container {
            display: flex;
            min-height: calc(100vh - 70px);
        }

        .sidebar {
            width: 250px;
            background-color: white;
            box-shadow: var(--shadow);
            padding: 1.5rem 0;
            transition: var(--transition);
            z-index: 90;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 0.5rem;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: var(--dark-color);
            text-decoration: none;
            transition: var(--transition);
            border-left: 4px solid transparent;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: rgba(44, 120, 108, 0.1);
            border-left-color: var(--primary-color);
            color: var(--primary-color);
        }

        .sidebar-menu i {
            margin-right: 0.75rem;
            font-size: 1.1rem;
        }

        .main-content {
            flex: 1;
            padding: 2rem;
            background-color: #f9f9f9;
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background-color: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        .card h3 {
            font-size: 1rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .card .value {
            font-size: 2rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .card .description {
            font-size: 0.9rem;
            color: #777;
        }

        .card.active-jobs {
            border-top: 4px solid var(--primary-color);
        }

        .card.returned-items {
            border-top: 4px solid var(--success-color);
        }

        .card.recent-activities {
            border-top: 4px solid var(--accent-color);
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--secondary-color);
            position: relative;
            padding-bottom: 0.5rem;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background-color: var(--accent-color);
        }

        .recent-table {
            width: 100%;
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .recent-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .recent-table th, .recent-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .recent-table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
        }

        .recent-table tr:last-child td {
            border-bottom: none;
        }

        .recent-table tr:hover {
            background-color: rgba(44, 120, 108, 0.05);
        }

        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-badge.issued {
            background-color: rgba(255, 193, 7, 0.2);
            color: #d39e00;
        }

        .status-badge.returned {
            background-color: rgba(40, 167, 69, 0.2);
            color: #218838;
        }

        /* Form Styles */
        .form-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-control {
            margin-bottom: 1rem;
        }

        .form-control label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-control input, .form-control select, .form-control textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control input:focus, .form-control select:focus, .form-control textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 120, 108, 0.2);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        /* Items List */
        .items-list {
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .search-bar {
            padding: 1rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .search-bar input {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 300px;
        }

        .table-responsive {
            overflow-x: auto;
        }

        /* Report Section */
        .report-filters {
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .filter-row {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1rem;
            align-items: flex-end;
        }

        .filter-group {
            flex: 1;
        }

        .generate-btn {
            background-color: var(--accent-color);
            color: var(--dark-color);
        }

        .generate-btn:hover {
            background-color: #e0a800;
        }

        /* Footer */
        .footer {
            background-color: var(--secondary-color);
            color: white;
            text-align: center;
            padding: 1rem;
            font-size: 0.9rem;
        }

        /* Animations */
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .animate-slide-in {
            animation: slideIn 0.5s ease forwards;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .content-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 1rem;
            }
            
            .sidebar-menu {
                display: flex;
                overflow-x: auto;
                padding-bottom: 0.5rem;
            }
            
            .sidebar-menu li {
                margin-right: 1rem;
                margin-bottom: 0;
                white-space: nowrap;
            }
            
            .sidebar-menu a {
                padding: 0.5rem 1rem;
                border-left: none;
                border-bottom: 3px solid transparent;
            }
            
            .sidebar-menu a:hover, .sidebar-menu a.active {
                border-left: none;
                border-bottom-color: var(--primary-color);
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
                padding: 1rem;
            }
            
            .header h1, .header h2 {
                margin-bottom: 0.5rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .filter-row {
                flex-direction: column;
                gap: 1rem;
            }
            
            .search-bar {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .search-bar input {
                width: 100%;
            }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: var(--primary-color);
            font-size: 1.25rem;
        }

        .modal-header .close {
            font-size: 1.5rem;
            cursor: pointer;
            color: #777;
            transition: var(--transition);
        }

        .modal-header .close:hover {
            color: var(--danger-color);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        
        /* Tool Inventory Styles */
        .tool-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: var(--transition);
        }
        
        .tool-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }
        
        .tool-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .tool-title {
            font-size: 1.25rem;
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .tool-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-available {
            background-color: rgba(40, 167, 69, 0.2);
            color: #218838;
        }
        
        .status-issued {
            background-color: rgba(255, 193, 7, 0.2);
            color: #d39e00;
        }
        
        .status-maintenance {
            background-color: rgba(220, 53, 69, 0.2);
            color: #c82333;
        }
        
        .status-damaged {
            background-color: rgba(220, 53, 69, 0.2);
            color: #c82333;
        }
        
        .status-lost {
            background-color: rgba(108, 117, 125, 0.2);
            color: #5a6268;
        }
        
        .tool-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .tool-detail {
            display: flex;
            flex-direction: column;
        }
        
        .detail-label {
            font-size: 0.8rem;
            color: #777;
            margin-bottom: 0.25rem;
        }
        
        .detail-value {
            font-weight: 500;
        }
        
        .tool-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
        }
        
        .add-tool-btn {
            margin-bottom: 1.5rem;
        }
        
        /* Tool Form */
        .tool-form-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        /* Search and Filter */
        .tool-filters {
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        /* Remove Tool Form */
        .remove-tool-form {
            background-color: #fff8e1;
            border-left: 4px solid var(--warning-color);
            padding: 1rem;
            margin-top: 1.5rem;
            border-radius: 5px;
        }
        
        .damage-reason {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
        }
        
        .damage-reason label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: normal;
        }

        /* Searchable dropdown */
        .searchable-dropdown {
            position: relative;
        }
        
        .dropdown-search {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 0.5rem;
        }
        
        .dropdown-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        
        .dropdown-options.show {
            display: block;
        }
        
        .dropdown-option {
            padding: 0.5rem;
            cursor: pointer;
        }
        
        .dropdown-option:hover {
            background-color: #f0f0f0;
        }

        /* Quick actions */
        .quick-actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .quick-action-btn {
            padding: 0.5rem 1rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .quick-action-btn:hover {
            background: var(--secondary-color);
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-container" id="login-page">
        <div class="login-box">
            <h2>Store Management System</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Enter username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter password" required>
                </div>
                <button type="submit" class="btn">Login</button>
                <div class="error-message" id="login-error"></div>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div class="main-container" id="app-container">
        <!-- Header -->
        <header class="header">
            <div>
                <h1>STORE MANAGEMENT SYSTEM</h1>
                <h2>Vidul Bio-Mass (Pvt) Ltd , Dehiattakandiya</h2>
            </div>
            <button class="logout-btn" id="logout-btn">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </header>

        <!-- Main Content -->
        <div class="content-container">
            <!-- Sidebar -->
            <aside class="sidebar">
                <ul class="sidebar-menu">
                    <li><a href="#" class="active" id="dashboard-link"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                    <li><a href="#" id="issue-items-link"><i class="fas fa-arrow-circle-up"></i> Issue Items</a></li>
                    <li><a href="#" id="return-items-link"><i class="fas fa-arrow-circle-down"></i> Return Items</a></li>
                    <li><a href="#" id="reports-link"><i class="fas fa-chart-bar"></i> Reports</a></li>
                    <li><a href="#" id="tool-inventory-link"><i class="fas fa-tools"></i> Tool Inventory</a></li>
                </ul>
            </aside>

            <!-- Main Content Area -->
            <main class="main-content" id="main-content">
                <!-- Dashboard Content (Default) -->
                <div id="dashboard-content">
                    <h2 class="section-title">Dashboard Overview</h2>
                    
                    <div class="dashboard-cards">
                        <div class="card active-jobs">
                            <h3>Active Jobs</h3>
                            <div class="value" id="active-jobs-count">0</div>
                            <div class="description">Items currently issued</div>
                        </div>
                        
                        <div class="card returned-items">
                            <h3>Items Checked Out</h3>
                            <div class="value" id="returned-items-count">0</div>
                            <div class="description">Items returned today</div>
                        </div>
                        
                        <div class="card recent-activities">
                            <h3>Recent Activities</h3>
                            <div class="value" id="recent-activities-count">0</div>
                            <div class="description">Today's transactions</div>
                        </div>
                    </div>
                    
                    <h2 class="section-title">Recent Transactions</h2>
                    <div class="recent-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Job ID</th>
                                    <th>Item Name</th>
                                    <th>Quantity</th>
                                    <th>Issued To</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="recent-transactions">
                                <!-- Recent transactions will be loaded here -->
                                <tr><td colspan="6" style="text-align: center;">No recent transactions</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Issue Items Content -->
                <div id="issue-items-content" style="display: none;">
                    <h2 class="section-title">Issue Items from Store</h2>
                    
                    <div class="form-container">
                        <form id="issue-item-form">
                            <div class="form-row">
                                <div class="form-control searchable-dropdown">
                                    <label for="issued-to">Person Name</label>
                                    <input type="text" class="dropdown-search" id="person-search" placeholder="Search person...">
                                    <div class="dropdown-options" id="person-options"></div>
                                    <select id="issued-to" required style="display: none;">
                                        <option value="">Select Person</option>
                                        <!-- 100 names will be populated by JavaScript -->
                                    </select>
                                </div>
                                <div class="form-control searchable-dropdown">
                                    <label for="purpose">Purpose</label>
                                    <input type="text" class="dropdown-search" id="purpose-search" placeholder="Search purpose...">
                                    <div class="dropdown-options" id="purpose-options"></div>
                                    <select id="purpose" required style="display: none;">
                                        <option value="">Select Purpose</option>
                                        <!-- 30 purposes will be populated by JavaScript -->
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-control">
                                    <label for="issue-date">Date</label>
                                    <input type="date" id="issue-date" required>
                                </div>
                            </div>
                            
                            <h3 style="margin: 1.5rem 0 1rem; color: var(--primary-color);">Items to Issue</h3>
                            
                            <div id="items-container">
                                <div class="item-row form-row" data-index="0">
                                    <div class="form-control">
                                        <label for="item-name-0">Item Name</label>
                                        <input type="text" id="item-name-0" placeholder="Enter item name" required>
                                    </div>
                                    <div class="form-control">
                                        <label for="item-quantity-0">Quantity</label>
                                        <input type="number" id="item-quantity-0" placeholder="Enter quantity" min="1" required>
                                    </div>
                                    <div class="form-control">
                                        <label for="item-unit-0">Unit (optional)</label>
                                        <input type="text" id="item-unit-0" placeholder="kg, liters, etc.">
                                    </div>
                                    <div class="form-control" style="align-self: flex-end;">
                                        <button type="button" class="btn btn-secondary remove-item" style="padding: 0.75rem;" disabled>
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <button type="button" class="btn btn-secondary" id="add-item-btn" style="margin-top: 1rem;">
                                <i class="fas fa-plus"></i> Add Another Item
                            </button>
                            
                            <div style="margin-top: 2rem;">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-paper-plane"></i> Issue Items
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <h2 class="section-title" style="margin-top: 2rem;">Recently Issued Items</h2>
                    <div class="items-list">
                        <div class="search-bar">
                            <input type="text" id="search-issued" placeholder="Search issued items...">
                        </div>
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Job ID</th>
                                        <th>Issued To</th>
                                        <th>Purpose</th>
                                        <th>Date</th>
                                        <th>Items</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="issued-items-table">
                                    <!-- Issued items will be loaded here -->
                                    <tr><td colspan="7" style="text-align: center;">No issued items</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Return Items Content -->
                <div id="return-items-content" style="display: none;">
                    <h2 class="section-title">Return Items to Store</h2>
                    
                    <div class="form-container">
                        <form id="return-item-form">
                            <div class="form-control">
                                <label for="return-job-id">Job ID</label>
                                <input type="text" id="return-job-id" placeholder="Enter Job ID" required>
                            </div>
                            
                            <div style="margin-top: 1.5rem;">
                                <button type="button" class="btn btn-primary" id="load-job-items">
                                    <i class="fas fa-search"></i> Load Items
                                </button>
                            </div>
                            
                            <div id="return-items-container" style="margin-top: 2rem; display: none;">
                                <h3 style="margin-bottom: 1rem; color: var(--primary-color);">Items to Return</h3>
                                
                                <table style="width: 100%; border-collapse: collapse;">
                                    <thead>
                                        <tr style="background-color: #f5f5f5;">
                                            <th style="padding: 0.75rem; text-align: left;">Item Name</th>
                                            <th style="padding: 0.75rem; text-align: left;">Issued Qty</th>
                                            <th style="padding: 0.75rem; text-align: left;">Return Qty</th>
                                            <th style="padding: 0.75rem; text-align: left;">Unit</th>
                                            <th style="padding: 0.75rem; text-align: left;">Condition</th>
                                        </tr>
                                    </thead>
                                    <tbody id="items-to-return">
                                        <!-- Items to return will be loaded here -->
                                    </tbody>
                                </table>
                                
                                <div class="form-control" style="margin-top: 1.5rem;">
                                    <label for="return-notes">Notes (optional)</label>
                                    <textarea id="return-notes" rows="3" placeholder="Any notes about the return"></textarea>
                                </div>
                                
                                <div style="margin-top: 2rem;">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-check-circle"></i> Confirm Return
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                    
                    <h2 class="section-title" style="margin-top: 2rem;">Recent Returns</h2>
                    <div class="items-list">
                        <div class="search-bar">
                            <input type="text" id="search-returns" placeholder="Search returned items...">
                        </div>
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Return ID</th>
                                        <th>Job ID</th>
                                        <th>Return Date</th>
                                        <th>Items Returned</th>
                                        <th>Condition</th>
                                        <th>Notes</th>
                                    </tr>
                                </thead>
                                <tbody id="returned-items-table">
                                    <!-- Returned items will be loaded here -->
                                    <tr><td colspan="6" style="text-align: center;">No returned items</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Reports Content -->
                <div id="reports-content" style="display: none;">
                    <h2 class="section-title">Generate Reports</h2>
                    
                    <div class="report-filters">
                        <form id="report-form">
                            <div class="filter-row">
                                <div class="filter-group">
                                    <label for="report-type">Report Type</label>
                                    <select id="report-type" class="form-control">
                                        <option value="issued">Issued Items</option>
                                        <option value="returned">Returned Items</option>
                                        <option value="damaged">Damaged Items</option>
                                        <option value="lost">Lost Items</option>
                                        <option value="active">Active Items</option>
                                        <option value="lubricants">Grease/Lubricant Oil</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label for="time-period">Time Period</label>
                                    <select id="time-period" class="form-control">
                                        <option value="daily">Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly">Monthly</option>
                                        <option value="annual">Annual</option>
                                        <option value="custom">Custom Date Range</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="filter-row" id="custom-date-range" style="display: none;">
                                <div class="filter-group">
                                    <label for="start-date">Start Date</label>
                                    <input type="date" id="start-date" class="form-control">
                                </div>
                                <div class="filter-group">
                                    <label for="end-date">End Date</label>
                                    <input type="date" id="end-date" class="form-control">
                                </div>
                            </div>
                            
                            <div style="margin-top: 1.5rem;">
                                <button type="submit" class="btn generate-btn">
                                    <i class="fas fa-file-pdf"></i> Generate Report
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div id="report-results" style="display: none;">
                        <h2 class="section-title">Report Results</h2>
                        <div class="items-list">
                            <div class="search-bar">
                                <div style="display: flex; justify-content: space-between; width: 100%;">
                                    <span id="report-title">Issued Items Report</span>
                                    <button type="button" class="btn btn-secondary" id="download-pdf">
                                        <i class="fas fa-download"></i> Download PDF
                                    </button>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Date</th>
                                            <th>Item Name</th>
                                            <th>Quantity</th>
                                            <th>Unit</th>
                                            <th>Issued To</th>
                                            <th>Purpose</th>
                                            <th>Condition</th>
                                        </tr>
                                    </thead>
                                    <tbody id="report-results-table">
                                        <!-- Report results will be loaded here -->
                                        <tr><td colspan="8" style="text-align: center;">No data to display</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tool Inventory Content -->
                <div id="tool-inventory-content" style="display: none;">
                    <h2 class="section-title">Tool Inventory Management</h2>
                    
                    <div class="quick-actions">
                        <button class="btn btn-primary add-tool-btn" id="add-tool-btn">
                            <i class="fas fa-plus"></i> Add New Tool
                        </button>
                        <button class="quick-action-btn" id="btn-damaged-tools">
                            <i class="fas fa-times-circle"></i> View Damaged Tools
                        </button>
                        <button class="quick-action-btn" id="btn-lost-tools">
                            <i class="fas fa-question-circle"></i> View Lost Tools
                        </button>
                    </div>
                    
                    <div class="tool-filters">
                        <div class="filter-grid">
                            <div class="form-control">
                                <label for="tool-search">Search Tools</label>
                                <input type="text" id="tool-search" placeholder="Search by name, ID, or category">
                            </div>
                            <div class="form-control">
                                <label for="status-filter">Filter by Status</label>
                                <select id="status-filter">
                                    <option value="all">All Statuses</option>
                                    <option value="available">Available</option>
                                    <option value="issued">Issued</option>
                                    <option value="maintenance">Maintenance</option>
                                    <option value="damaged">Damaged</option>
                                    <option value="lost">Lost</option>
                                </select>
                            </div>
                            <div class="form-control">
                                <label for="category-filter">Filter by Category</label>
                                <select id="category-filter">
                                    <option value="all">All Categories</option>
                                    <option value="hand-tools">Hand Tools</option>
                                    <option value="power-tools">Power Tools</option>
                                    <option value="safety-equipment">Safety Equipment</option>
                                    <option value="measuring-tools">Measuring Tools</option>
                                    <option value="lubricants">Grease/Lubricants</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div id="tools-list">
                        <!-- Tool cards will be loaded here -->
                        <div class="tool-card">
                            <p style="text-align: center;">No tools found in inventory.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Add/Edit Tool Modal -->
                <div class="modal" id="tool-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 id="tool-modal-title">Add New Tool</h3>
                            <span class="close">&times;</span>
                        </div>
                        <div class="modal-body">
                            <form id="tool-form">
                                <input type="hidden" id="tool-id">
                                <div class="form-row">
                                    <div class="form-control">
                                        <label for="tool-name">Tool Name *</label>
                                        <input type="text" id="tool-name" required>
                                    </div>
                                    <div class="form-control">
                                        <label for="tool-size">Size/Model</label>
                                        <input type="text" id="tool-size">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-control">
                                        <label for="tool-category">Category *</label>
                                        <select id="tool-category" required>
                                            <option value="">Select Category</option>
                                            <option value="hand-tools">Hand Tools</option>
                                            <option value="power-tools">Power Tools</option>
                                            <option value="safety-equipment">Safety Equipment</option>
                                            <option value="measuring-tools">Measuring Tools</option>
                                            <option value="lubricants">Grease/Lubricants</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                    <div class="form-control">
                                        <label for="tool-quantity">Quantity *</label>
                                        <input type="number" id="tool-quantity" min="1" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-control">
                                        <label for="tool-status">Status *</label>
                                        <select id="tool-status" required>
                                            <option value="available">Available</option>
                                            <option value="issued">Issued</option>
                                            <option value="maintenance">Maintenance</option>
                                            <option value="damaged">Damaged</option>
                                            <option value="lost">Lost</option>
                                        </select>
                                    </div>
                                    <div class="form-control">
                                        <label for="tool-date">Date</label>
                                        <input type="date" id="tool-date">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-control">
                                        <label for="tool-location">Storage Location</label>
                                        <input type="text" id="tool-location">
                                    </div>
                                    <div class="form-control">
                                        <label for="tool-condition">Condition</label>
                                        <select id="tool-condition">
                                            <option value="excellent">Excellent</option>
                                            <option value="good">Good</option>
                                            <option value="fair">Fair</option>
                                            <option value="poor">Poor</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-control">
                                    <label for="tool-notes">Notes</label>
                                    <textarea id="tool-notes" rows="3"></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary close-modal">Cancel</button>
                            <button type="button" class="btn btn-primary" id="save-tool-btn">Save Tool</button>
                        </div>
                    </div>
                </div>
                
                <!-- Remove Tool Modal -->
                <div class="modal" id="remove-tool-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Remove Tool from Inventory</h3>
                            <span class="close">&times;</span>
                        </div>
                        <div class="modal-body">
                            <form id="remove-tool-form">
                                <input type="hidden" id="remove-tool-id">
                                <div class="form-row">
                                    <div class="form-control">
                                        <label for="remove-tool-name">Tool Name</label>
                                        <input type="text" id="remove-tool-name" readonly>
                                    </div>
                                    <div class="form-control">
                                        <label for="remove-tool-quantity">Quantity to Remove *</label>
                                        <input type="number" id="remove-tool-quantity" min="1" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-control">
                                        <label for="remove-date">Date</label>
                                        <input type="date" id="remove-date" required>
                                    </div>
                                </div>
                                <div class="form-control">
                                    <label>Reason for Removal *</label>
                                    <div class="damage-reason">
                                        <label>
                                            <input type="radio" name="removal-reason" value="damage" required>
                                            Damage
                                        </label>
                                        <label>
                                            <input type="radio" name="removal-reason" value="loss" required>
                                            Loss
                                        </label>
                                    </div>
                                </div>
                                <div class="form-control">
                                    <label for="remove-notes">Additional Notes</label>
                                    <textarea id="remove-notes" rows="3"></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary close-modal">Cancel</button>
                            <button type="button" class="btn btn-danger" id="confirm-remove-btn">Confirm Removal</button>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>All Rights Reserved | M.G.A.D Dharmasiri</p>
            <p id="current-year"></p>
        </footer>
    </div>

    <!-- View Items Modal -->
    <div class="modal" id="view-items-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Issued Items Details</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <p><strong>Job ID:</strong> <span id="modal-job-id"></span></p>
                <p><strong>Issued To:</strong> <span id="modal-issued-to"></span></p>
                <p><strong>Purpose:</strong> <span id="modal-purpose"></span></p>
                <p><strong>Date:</strong> <span id="modal-date"></span></p>
                
                <h4 style="margin: 1.5rem 0 1rem; color: var(--primary-color);">Items Issued</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background-color: #f5f5f5;">
                            <th style="padding: 0.75rem; text-align: left;">Item Name</th>
                            <th style="padding: 0.75rem; text-align: left;">Quantity</th>
                            <th style="padding: 0.75rem; text-align: left;">Unit</th>
                        </tr>
                    </thead>
                    <tbody id="modal-items-list">
                        <!-- Items will be loaded here -->
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close-modal">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Sample data for dropdowns
        const personNames = [
            "A. B. Perera", "C. D. Silva", "E. F. Fernando", "G. H. Rajapaksa", "I. J. Jayawardena",
            "K. L. Bandara", "M. N. Gunawardena", "O. P. Wijewardena", "Q. R. Dissanayake", "S. T. Ratnayake",
            "U. V. Premaratne", "W. X. Alwis", "Y. Z. Weerasinghe", "A. C. Abeysekara", "B. D. Balasuriya",
            "E. G. Chandrasiri", "F. H. De Silva", "I. J. Ekanayake", "K. M. Fonseka", "L. N. Gamage",
            "N. O. Herath", "P. Q. Ilangaratne", "R. S. Jayasuriya", "T. U. Karunaratne", "V. W. Liyanage",
            "X. Y. Mendis", "Z. A. Nanayakkara", "B. C. Obeyesekere", "D. E. Peiris", "F. G. Ranatunga",
            "H. I. Samarakoon", "J. K. Tennakoon", "L. M. Udawatta", "N. O. Vithanage", "P. Q. Wickramasinghe",
            "R. S. Abeygunawardena", "T. U. Bandaranayake", "V. W. Chandrasekara", "X. Y. Dissanayake",
            "Z. A. Ekanayake", "B. C. Fonseka", "D. E. Gunawardena", "F. G. Hettiarachchi", "H. I. Jayaweera",
            "J. K. Kariyawasam", "L. M. Lokuge", "N. O. Mallawaarachchi", "P. Q. Nimalsiri", "R. S. Pathirana",
            "T. U. Rajapakse", "V. W. Seneviratne", "X. Y. Talwatte", "Z. A. Unamboowe", "B. C. Weerakoon",
            "D. E. Alagaratnam", "F. G. Balachandran", "H. I. Chandrasekaran", "J. K. Devendra", "L. M. Eswaran",
            "N. O. Fernando", "P. Q. Goonetilleke", "R. S. Hapuarachchi", "T. U. Iyer", "V. W. Jayawardene",
            "X. Y. Kularatne", "Z. A. Manamperi", "B. C. Navaratne", "D. E. Odiris", "F. G. Palihawadana",
            "H. I. Qureshi", "J. K. Ratnayake", "L. M. Senanayake", "N. O. Tissera", "P. Q. Undugoda",
            "R. S. Vanniarachchi", "T. U. Wijayathilake", "V. W. Xavier", "X. Y. Yapa", "Z. A. Zoysa",
            "A. B. Amunugama", "C. D. Bulumulla", "E. F. Cooray", "G. H. Dodangoda", "I. J. Edirisinghe",
            "K. L. Fdo", "M. N. Galappaththi", "O. P. Hettige", "Q. R. Iddamalgoda", "S. T. Jayaweera",
            "U. V. Kodituwakku", "W. X. Lionel", "Y. Z. Munasinghe", "A. C. Niranjan", "B. D. Ovitigala",
            "E. G. Panadura", "F. H. Ranaweera", "I. J. Seneviratne", "K. M. Thilakarathne", "L. N. Uduwella"
        ];
        
        const purposes = [
            "Construction Work", "Maintenance", "Repair Work", "Site Installation", "Equipment Setup",
            "Project Work", "Routine Check", "Emergency Repair", "Preventive Maintenance", "New Installation",
            "System Upgrade", "Testing", "Calibration", "Inspection", "Safety Audit",
            "Cleaning", "Landscaping", "Vehicle Maintenance", "Electrical Work", "Plumbing Work",
            "Painting", "Carpentry", "Welding", "Fabrication", "Machine Operation",
            "Training", "Demonstration", "Research", "Development", "Other"
        ];

        // Data storage (replacing Firebase for this demo)
        let issuedItems = JSON.parse(localStorage.getItem('issuedItems')) || [];
        let returnedItems = JSON.parse(localStorage.getItem('returnedItems')) || [];
        let tools = JSON.parse(localStorage.getItem('tools')) || [];
        let damagedItems = JSON.parse(localStorage.getItem('damagedItems')) || [];
        let lostItems = JSON.parse(localStorage.getItem('lostItems')) || [];
        let inventory = JSON.parse(localStorage.getItem('inventory')) || [];

        // DOM Elements
        const loginPage = document.getElementById('login-page');
        const appContainer = document.getElementById('app-container');
        const loginForm = document.getElementById('login-form');
        const logoutBtn = document.getElementById('logout-btn');
        const loginError = document.getElementById('login-error');
        
        // Sidebar links
        const dashboardLink = document.getElementById('dashboard-link');
        const issueItemsLink = document.getElementById('issue-items-link');
        const returnItemsLink = document.getElementById('return-items-link');
        const reportsLink = document.getElementById('reports-link');
        const toolInventoryLink = document.getElementById('tool-inventory-link');
        
        // Content sections
        const dashboardContent = document.getElementById('dashboard-content');
        const issueItemsContent = document.getElementById('issue-items-content');
        const returnItemsContent = document.getElementById('return-items-content');
        const reportsContent = document.getElementById('reports-content');
        const toolInventoryContent = document.getElementById('tool-inventory-content');
        
        // Tool Inventory Elements
        const addToolBtn = document.getElementById('add-tool-btn');
        const toolModal = document.getElementById('tool-modal');
        const removeToolModal = document.getElementById('remove-tool-modal');
        const saveToolBtn = document.getElementById('save-tool-btn');
        const confirmRemoveBtn = document.getElementById('confirm-remove-btn');
        const toolsList = document.getElementById('tools-list');
        const btnDamagedTools = document.getElementById('btn-damaged-tools');
        const btnLostTools = document.getElementById('btn-lost-tools');
        
        // Current year for footer
        document.getElementById('current-year').textContent = new Date().getFullYear();

        // Initialize the application
        function initApp() {
            populateDropdowns();
            setupSearchableDropdowns();
            loadDashboardData();
            
            // Set up event listeners
            document.getElementById('tool-search').addEventListener('input', filterTools);
            document.getElementById('status-filter').addEventListener('change', filterTools);
            document.getElementById('category-filter').addEventListener('change', filterTools);
            
            btnDamagedTools.addEventListener('click', () => {
                document.getElementById('status-filter').value = 'damaged';
                filterTools();
            });
            
            btnLostTools.addEventListener('click', () => {
                document.getElementById('status-filter').value = 'lost';
                filterTools();
            });
        }

        // Populate dropdowns
        function populateDropdowns() {
            const issuedToSelect = document.getElementById('issued-to');
            const purposeSelect = document.getElementById('purpose');
            
            // Clear existing options
            issuedToSelect.innerHTML = '<option value="">Select Person</option>';
            purposeSelect.innerHTML = '<option value="">Select Purpose</option>';
            
            // Add person names
            personNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                issuedToSelect.appendChild(option);
            });
            
            // Add purposes
            purposes.forEach(purpose => {
                const option = document.createElement('option');
                option.value = purpose;
                option.textContent = purpose;
                purposeSelect.appendChild(option);
            });
        }

        // Setup searchable dropdowns
        function setupSearchableDropdowns() {
            const personSearch = document.getElementById('person-search');
            const personOptions = document.getElementById('person-options');
            const purposeSearch = document.getElementById('purpose-search');
            const purposeOptions = document.getElementById('purpose-options');
            const issuedToSelect = document.getElementById('issued-to');
            const purposeSelect = document.getElementById('purpose');
            
            // Person search functionality
            personSearch.addEventListener('focus', () => {
                updateDropdownOptions(personOptions, personNames, personSearch.value);
                personOptions.classList.add('show');
            });
            
            personSearch.addEventListener('input', () => {
                updateDropdownOptions(personOptions, personNames, personSearch.value);
                personOptions.classList.add('show');
            });
            
            personSearch.addEventListener('blur', () => {
                setTimeout(() => {
                    personOptions.classList.remove('show');
                }, 200);
            });
            
            // Purpose search functionality
            purposeSearch.addEventListener('focus', () => {
                updateDropdownOptions(purposeOptions, purposes, purposeSearch.value);
                purposeOptions.classList.add('show');
            });
            
            purposeSearch.addEventListener('input', () => {
                updateDropdownOptions(purposeOptions, purposes, purposeSearch.value);
                purposeOptions.classList.add('show');
            });
            
            purposeSearch.addEventListener('blur', () => {
                setTimeout(() => {
                    purposeOptions.classList.remove('show');
                }, 200);
            });
            
            // Add click handlers for dropdown options
            personOptions.addEventListener('click', (e) => {
                if (e.target.classList.contains('dropdown-option')) {
                    personSearch.value = e.target.textContent;
                    // Find and set the corresponding select value
                    for (let option of issuedToSelect.options) {
                        if (option.textContent === e.target.textContent) {
                            issuedToSelect.value = option.value;
                            break;
                        }
                    }
                    personOptions.classList.remove('show');
                }
            });
            
            purposeOptions.addEventListener('click', (e) => {
                if (e.target.classList.contains('dropdown-option')) {
                    purposeSearch.value = e.target.textContent;
                    // Find and set the corresponding select value
                    for (let option of purposeSelect.options) {
                        if (option.textContent === e.target.textContent) {
                            purposeSelect.value = option.value;
                            break;
                        }
                    }
                    purposeOptions.classList.remove('show');
                }
            });
        }
        
        function updateDropdownOptions(container, options, searchTerm) {
            container.innerHTML = '';
            const filteredOptions = options.filter(option => 
                option.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            if (filteredOptions.length === 0) {
                const noResult = document.createElement('div');
                noResult.className = 'dropdown-option';
                noResult.textContent = 'No results found';
                container.appendChild(noResult);
            } else {
                filteredOptions.forEach(option => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'dropdown-option';
                    optionElement.textContent = option;
                    container.appendChild(optionElement);
                });
            }
        }

        // Login Functionality
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === 'Dehiattakandiya' && password === 'Vidul2025') {
                loginError.textContent = '';
                loginPage.style.display = 'none';
                appContainer.style.display = 'block';
                initApp();
            } else {
                loginError.textContent = 'Invalid username or password';
            }
        });

        // Logout Functionality
        logoutBtn.addEventListener('click', () => {
            loginPage.style.display = 'flex';
            appContainer.style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        });

        // Navigation
        dashboardLink.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('dashboard');
            setActiveLink(dashboardLink);
            loadDashboardData();
        });

        issueItemsLink.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('issue-items');
            setActiveLink(issueItemsLink);
            loadIssuedItems();
        });

        returnItemsLink.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('return-items');
            setActiveLink(returnItemsLink);
            loadReturnedItems();
        });

        reportsLink.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('reports');
            setActiveLink(reportsLink);
        });

        toolInventoryLink.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('tool-inventory');
            setActiveLink(toolInventoryLink);
            loadTools();
        });

        function showSection(section) {
            // Hide all sections
            dashboardContent.style.display = 'none';
            issueItemsContent.style.display = 'none';
            returnItemsContent.style.display = 'none';
            reportsContent.style.display = 'none';
            toolInventoryContent.style.display = 'none';
            
            // Show selected section
            switch(section) {
                case 'dashboard':
                    dashboardContent.style.display = 'block';
                    break;
                case 'issue-items':
                    issueItemsContent.style.display = 'block';
                    break;
                case 'return-items':
                    returnItemsContent.style.display = 'block';
                    break;
                case 'reports':
                    reportsContent.style.display = 'block';
                    break;
                case 'tool-inventory':
                    toolInventoryContent.style.display = 'block';
                    break;
            }
        }

        function setActiveLink(activeLink) {
            // Remove active class from all links
            const links = document.querySelectorAll('.sidebar-menu a');
            links.forEach(link => link.classList.remove('active'));
            
            // Add active class to clicked link
            activeLink.classList.add('active');
        }

        // Issue Items Form
        const issueItemForm = document.getElementById('issue-item-form');
        const itemsContainer = document.getElementById('items-container');
        const addItemBtn = document.getElementById('add-item-btn');
        
        let itemCount = 1; // Start from 1 since we have one row by default

        // Add new item row
        addItemBtn.addEventListener('click', () => {
            const newRow = document.createElement('div');
            newRow.className = 'item-row form-row';
            newRow.dataset.index = itemCount;
            
            newRow.innerHTML = `
                <div class="form-control">
                    <label for="item-name-${itemCount}">Item Name</label>
                    <input type="text" id="item-name-${itemCount}" placeholder="Enter item name" required>
                </div>
                <div class="form-control">
                    <label for="item-quantity-${itemCount}">Quantity</label>
                    <input type="number" id="item-quantity-${itemCount}" placeholder="Enter quantity" min="1" required>
                </div>
                <div class="form-control">
                    <label for="item-unit-${itemCount}">Unit (optional)</label>
                    <input type="text" id="item-unit-${itemCount}" placeholder="kg, liters, etc.">
                </div>
                <div class="form-control" style="align-self: flex-end;">
                    <button type="button" class="btn btn-secondary remove-item" style="padding: 0.75rem;">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            itemsContainer.appendChild(newRow);
            itemCount++;
            
            // Enable remove button for the first row if there are multiple rows
            if (itemCount > 1) {
                document.querySelector('.remove-item').disabled = false;
            }
        });

        // Remove item row
        itemsContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('remove-item') || e.target.closest('.remove-item')) {
                const row = e.target.closest('.item-row');
                if (itemsContainer.childElementCount > 1) {
                    row.remove();
                    
                    // If only one row left, disable its remove button
                    if (itemsContainer.childElementCount === 1) {
                        document.querySelector('.remove-item').disabled = true;
                    }
                }
            }
        });

        // Submit issue item form
        issueItemForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const issuedTo = document.getElementById('issued-to').value;
            const purpose = document.getElementById('purpose').value;
            const issueDate = document.getElementById('issue-date').value || new Date().toISOString().split('T')[0];
            
            // Collect items data
            const items = [];
            const itemRows = document.querySelectorAll('.item-row');
            
            itemRows.forEach(row => {
                const index = row.dataset.index;
                items.push({
                    name: document.getElementById(`item-name-${index}`).value,
                    quantity: parseInt(document.getElementById(`item-quantity-${index}`).value),
                    unit: document.getElementById(`item-unit-${index}`).value || null
                });
            });
            
            // Generate job ID (timestamp + random 3 digits)
            const jobId = `${Date.now()}${Math.floor(Math.random() * 900) + 100}`;
            
            try {
                // Save to storage
                issuedItems.push({
                    jobId,
                    issuedTo,
                    purpose,
                    date: issueDate,
                    items,
                    status: 'issued',
                    createdAt: new Date().toISOString()
                });
                
                // Save to localStorage
                localStorage.setItem('issuedItems', JSON.stringify(issuedItems));
                
                // Update inventory (reduce quantities)
                for (const item of items) {
                    await updateInventory(item.name, -item.quantity);
                }
                
                alert('Items issued successfully! Job ID: ' + jobId);
                issueItemForm.reset();
                
                // Reset to one item row
                while (itemsContainer.childElementCount > 1) {
                    itemsContainer.lastChild.remove();
                }
                document.querySelector('.remove-item').disabled = true;
                
                // Reload issued items table
                loadIssuedItems();
                loadDashboardData();
            } catch (error) {
                console.error('Error issuing items:', error);
                alert('Failed to issue items. Please try again.');
            }
        });

        // Return Items Form
        const returnItemForm = document.getElementById('return-item-form');
        const loadJobItemsBtn = document.getElementById('load-job-items');
        const returnItemsContainer = document.getElementById('return-items-container');
        
        loadJobItemsBtn.addEventListener('click', async () => {
            const jobId = document.getElementById('return-job-id').value.trim();
            
            if (!jobId) {
                alert('Please enter a Job ID');
                return;
            }
            
            try {
                // Find the issued item
                const issuedItem = issuedItems.find(item => item.jobId === jobId);
                
                if (!issuedItem) {
                    alert('Job ID not found');
                    returnItemsContainer.style.display = 'none';
                    return;
                }
                
                if (issuedItem.status === 'returned') {
                    alert('All items for this job have already been returned');
                    returnItemsContainer.style.display = 'none';
                    return;
                }
                
                // Display items to return
                const itemsToReturn = document.getElementById('items-to-return');
                itemsToReturn.innerHTML = '';
                
                issuedItem.items.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.name}</td>
                        <td>${item.quantity}</td>
                        <td><input type="number" value="${item.quantity}" min="0" max="${item.quantity}" class="return-qty"></td>
                        <td>${item.unit || '-'}</td>
                        <td>
                            <select class="item-condition">
                                <option value="good">Good</option>
                                <option value="damaged">Damaged</option>
                            </select>
                        </td>
                    `;
                    itemsToReturn.appendChild(row);
                });
                
                returnItemsContainer.style.display = 'block';
            } catch (error) {
                console.error('Error loading job items:', error);
                alert('Failed to load job items. Please try again.');
            }
        });

        returnItemForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const jobId = document.getElementById('return-job-id').value.trim();
            const notes = document.getElementById('return-notes').value;
            const returnDate = new Date().toISOString().split('T')[0];
            
            // Get quantities to return and conditions
            const returnQuantities = [];
            const returnConditions = [];
            const returnQtyInputs = document.querySelectorAll('.return-qty');
            const conditionSelects = document.querySelectorAll('.item-condition');
            
            returnQtyInputs.forEach(input => {
                returnQuantities.push(parseInt(input.value));
            });
            
            conditionSelects.forEach(select => {
                returnConditions.push(select.value);
            });
            
            try {
                // Get the issued items document
                const issuedItemIndex = issuedItems.findIndex(item => item.jobId === jobId);
                const issuedItem = issuedItems[issuedItemIndex];
                
                // Check if all items are being returned
                let allReturned = true;
                const items = issuedItem.items.map((item, index) => {
                    if (returnQuantities[index] < item.quantity) {
                        allReturned = false;
                    }
                    return {
                        ...item,
                        returnedQuantity: returnQuantities[index],
                        condition: returnConditions[index]
                    };
                });
                
                // Create return record
                const returnId = `${Date.now()}${Math.floor(Math.random() * 900) + 100}`;
                
                returnedItems.push({
                    returnId,
                    jobId,
                    items,
                    notes,
                    date: returnDate,
                    createdAt: new Date().toISOString()
                });
                
                // Update issued items status if all returned
                if (allReturned) {
                    issuedItems[issuedItemIndex].status = 'returned';
                }
                
                // Save to localStorage
                localStorage.setItem('returnedItems', JSON.stringify(returnedItems));
                localStorage.setItem('issuedItems', JSON.stringify(issuedItems));
                
                // Update inventory (add returned quantities)
                for (let i = 0; i < items.length; i++) {
                    await updateInventory(items[i].name, returnQuantities[i]);
                    
                    // If item is damaged, update damaged items collection
                    if (returnConditions[i] === 'damaged') {
                        damagedItems.push({
                            itemName: items[i].name,
                            quantity: returnQuantities[i],
                            jobId: jobId,
                            returnId: returnId,
                            date: returnDate,
                            notes: notes || 'Item returned in damaged condition',
                            createdAt: new Date().toISOString()
                        });
                        localStorage.setItem('damagedItems', JSON.stringify(damagedItems));
                    }
                }
                
                alert('Items returned successfully! Return ID: ' + returnId);
                returnItemForm.reset();
                returnItemsContainer.style.display = 'none';
                
                // Reload returned items table
                loadReturnedItems();
                loadDashboardData();
            } catch (error) {
                console.error('Error returning items:', error);
                alert('Failed to return items. Please try again.');
            }
        });

        // Reports Form
        const reportForm = document.getElementById('report-form');
        const reportType = document.getElementById('report-type');
        const timePeriod = document.getElementById('time-period');
        const customDateRange = document.getElementById('custom-date-range');
        const reportResults = document.getElementById('report-results');
        
        timePeriod.addEventListener('change', () => {
            customDateRange.style.display = timePeriod.value === 'custom' ? 'flex' : 'none';
        });

        reportForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const reportTypeValue = reportType.value;
            const timePeriodValue = timePeriod.value;
            
            // Calculate date range based on time period
            let startDate, endDate = new Date();
            
            switch(timePeriodValue) {
                case 'daily':
                    startDate = new Date();
                    break;
                case 'weekly':
                    startDate = new Date();
                    startDate.setDate(startDate.getDate() - 7);
                    break;
                case 'monthly':
                    startDate = new Date();
                    startDate.setMonth(startDate.getMonth() - 1);
                    break;
                case 'annual':
                    startDate = new Date();
                    startDate.setFullYear(startDate.getFullYear() - 1);
                    break;
                case 'custom':
                    startDate = new Date(document.getElementById('start-date').value);
                    endDate = new Date(document.getElementById('end-date').value);
                    break;
            }
            
            // Format dates for display
            const formatDate = (date) => {
                return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
            };
            
            // Set report title
            let title = '';
            switch(reportTypeValue) {
                case 'issued':
                    title = 'Issued Items Report';
                    break;
                case 'returned':
                    title = 'Returned Items Report';
                    break;
                case 'damaged':
                    title = 'Damaged Items Report';
                    break;
                case 'lost':
                    title = 'Lost Items Report';
                    break;
                case 'active':
                    title = 'Active Items Report';
                    break;
                case 'lubricants':
                    title = 'Grease/Lubricant Oil Report';
                    break;
            }
            
            if (timePeriodValue !== 'custom') {
                title += ` (${formatDate(startDate)} to ${formatDate(endDate)})`;
            } else {
                title += ` (Custom Date Range)`;
            }
            
            document.getElementById('report-title').textContent = title;
            
            try {
                const resultsTable = document.getElementById('report-results-table');
                resultsTable.innerHTML = '';
                
                if (reportTypeValue === 'issued') {
                    const filteredItems = issuedItems.filter(item => {
                        const itemDate = new Date(item.date);
                        return itemDate >= startDate && itemDate <= endDate;
                    });
                    
                    if (filteredItems.length === 0) {
                        resultsTable.innerHTML = '<tr><td colspan="8" style="text-align: center;">No issued items found</td></tr>';
                    } else {
                        filteredItems.forEach(data => {
                            data.items.forEach(item => {
                                const row = document.createElement('tr');
                                row.innerHTML = `
                                    <td>${data.jobId}</td>
                                    <td>${data.date}</td>
                                    <td>${item.name}</td>
                                    <td>${item.quantity}</td>
                                    <td>${item.unit || '-'}</td>
                                    <td>${data.issuedTo}</td>
                                    <td>${data.purpose}</td>
                                    <td>-</td>
                                `;
                                resultsTable.appendChild(row);
                            });
                        });
                    }
                } else if (reportTypeValue === 'returned') {
                    const filteredItems = returnedItems.filter(item => {
                        const itemDate = new Date(item.date);
                        return itemDate >= startDate && itemDate <= endDate;
                    });
                    
                    if (filteredItems.length === 0) {
                        resultsTable.innerHTML = '<tr><td colspan="8" style="text-align: center;">No returned items found</td></tr>';
                    } else {
                        filteredItems.forEach(data => {
                            data.items.forEach(item => {
                                const row = document.createElement('tr');
                                row.innerHTML = `
                                    <td>${data.returnId}</td>
                                    <td>${data.date}</td>
                                    <td>${item.name}</td>
                                    <td>${item.returnedQuantity}</td>
                                    <td>${item.unit || '-'</td>
                                    <td>${data.jobId}</td>
                                    <td>-</td>
                                    <td>${item.condition || 'good'}</td>
                                `;
                                resultsTable.appendChild(row);
                            });
                        });
                    }
                } else if (reportTypeValue === 'damaged') {
                    // Show damaged tools from tool inventory
                    const damagedTools = tools.filter(tool => tool.status === 'damaged');
                    
                    if (damagedTools.length === 0) {
                        resultsTable.innerHTML = '<tr><td colspan="8" style="text-align: center;">No damaged tools found</td></tr>';
                    } else {
                        damagedTools.forEach(tool => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${tool.id}</td>
                                <td>${tool.date || tool.lastUpdated}</td>
                                <td>${tool.name}</td>
                                <td>${tool.quantity}</td>
                                <td>${tool.size || '-'}</td>
                                <td>-</td>
                                <td>${tool.notes || 'Damaged tool'}</td>
                                <td>damaged</td>
                            `;
                            resultsTable.appendChild(row);
                        });
                    }
                } else if (reportTypeValue === 'lost') {
                    // Show lost tools from tool inventory
                    const lostTools = tools.filter(tool => tool.status === 'lost');
                    
                    if (lostTools.length === 0) {
                        resultsTable.innerHTML = '<tr><td colspan="8" style="text-align: center;">No lost tools found</td></tr>';
                    } else {
                        lostTools.forEach(tool => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${tool.id}</td>
                                <td>${tool.date || tool.lastUpdated}</td>
                                <td>${tool.name}</td>
                                <td>${tool.quantity}</td>
                                <td>${tool.size || '-'}</td>
                                <td>-</td>
                                <td>${tool.notes || 'Lost tool'}</td>
                                <td>lost</td>
                            `;
                            resultsTable.appendChild(row);
                        });
                    }
                } else if (reportTypeValue === 'active') {
                    // Show active tools (not damaged or lost)
                    const activeTools = tools.filter(tool => 
                        tool.status !== 'damaged' && tool.status !== 'lost'
                    );
                    
                    if (activeTools.length === 0) {
                        resultsTable.innerHTML = '<tr><td colspan="8" style="text-align: center;">No active tools found</td></tr>';
                    } else {
                        activeTools.forEach(tool => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${tool.id}</td>
                                <td>${tool.date || tool.lastUpdated}</td>
                                <td>${tool.name}</td>
                                <td>${tool.quantity}</td>
                                <td>${tool.size || '-'}</td>
                                <td>${tool.location || '-'}</td>
                                <td>${tool.notes || '-'}</td>
                                <td>${tool.status}</td>
                            `;
                            resultsTable.appendChild(row);
                        });
                    }
                } else if (reportTypeValue === 'lubricants') {
                    // Get all items with category lubricants
                    const lubricants = tools.filter(tool => tool.category === 'lubricants');
                    
                    if (lubricants.length === 0) {
                        resultsTable.innerHTML = '<tr><td colspan="8" style="text-align: center;">No lubricant items found</td></tr>';
                    } else {
                        lubricants.forEach(tool => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${tool.id}</td>
                                <td>${tool.date || tool.lastUpdated}</td>
                                <td>${tool.name}</td>
                                <td>${tool.quantity}</td>
                                <td>${tool.size || '-'}</td>
                                <td>${tool.location || '-'}</td>
                                <td>${tool.notes || '-'}</td>
                                <td>${tool.status}</td>
                            `;
                            resultsTable.appendChild(row);
                        });
                    }
                }
                
                reportResults.style.display = 'block';
            } catch (error) {
                console.error('Error generating report:', error);
                alert('Failed to generate report. Please try again.');
            }
        });

        // Download PDF
        document.getElementById('download-pdf').addEventListener('click', () => {
            alert('PDF download functionality would be implemented here with a library like jsPDF.');
        });

        // View Items Modal
        const viewItemsModal = document.getElementById('view-items-modal');
        const modalCloseBtns = document.querySelectorAll('.close, .close-modal');
        
        modalCloseBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                viewItemsModal.style.display = 'none';
                toolModal.style.display = 'none';
                removeToolModal.style.display = 'none';
            });
        });

        window.addEventListener('click', (e) => {
            if (e.target === viewItemsModal) {
                viewItemsModal.style.display = 'none';
            }
            if (e.target === toolModal) {
                toolModal.style.display = 'none';
            }
            if (e.target === removeToolModal) {
                removeToolModal.style.display = 'none';
            }
        });

        // Tool Inventory Functions
        addToolBtn.addEventListener('click', () => {
            document.getElementById('tool-modal-title').textContent = 'Add New Tool';
            document.getElementById('tool-form').reset();
            document.getElementById('tool-id').value = '';
            document.getElementById('tool-date').valueAsDate = new Date();
            toolModal.style.display = 'flex';
        });

        saveToolBtn.addEventListener('click', async () => {
            const toolId = document.getElementById('tool-id').value;
            const toolData = {
                name: document.getElementById('tool-name').value,
                size: document.getElementById('tool-size').value || '',
                category: document.getElementById('tool-category').value,
                quantity: parseInt(document.getElementById('tool-quantity').value),
                status: document.getElementById('tool-status').value,
                date: document.getElementById('tool-date').value || new Date().toISOString().split('T')[0],
                location: document.getElementById('tool-location').value || '',
                condition: document.getElementById('tool-condition').value || 'good',
                notes: document.getElementById('tool-notes').value || '',
                lastUpdated: new Date().toISOString().split('T')[0]
            };
            
            if (!toolData.name || !toolData.category || !toolData.quantity) {
                alert('Please fill in all required fields');
                return;
            }
            
            try {
                if (toolId) {
                    // Update existing tool
                    const toolIndex = tools.findIndex(tool => tool.id === toolId);
                    if (toolIndex !== -1) {
                        tools[toolIndex] = {...tools[toolIndex], ...toolData};
                    }
                    alert('Tool updated successfully!');
                } else {
                    // Add new tool
                    toolData.id = `tool_${Date.now()}`;
                    toolData.createdAt = new Date().toISOString();
                    tools.push(toolData);
                    alert('Tool added successfully!');
                }
                
                // Save to localStorage
                localStorage.setItem('tools', JSON.stringify(tools));
                
                toolModal.style.display = 'none';
                loadTools();
            } catch (error) {
                console.error('Error saving tool:', error);
                alert('Failed to save tool. Please try again.');
            }
        });

        // Remove Tool Functionality
        confirmRemoveBtn.addEventListener('click', async () => {
            const toolId = document.getElementById('remove-tool-id').value;
            const quantityToRemove = parseInt(document.getElementById('remove-tool-quantity').value);
            const removeDate = document.getElementById('remove-date').value;
            const reason = document.querySelector('input[name="removal-reason"]:checked').value;
            const notes = document.getElementById('remove-notes').value;
            
            if (!toolId || !quantityToRemove || !removeDate || !reason) {
                alert('Please fill in all required fields');
                return;
            }
            
            try {
                // Get the tool details
                const toolIndex = tools.findIndex(tool => tool.id === toolId);
                if (toolIndex === -1) {
                    alert('Tool not found');
                    return;
                }
                
                const toolData = tools[toolIndex];
                const currentQuantity = toolData.quantity;
                
                if (quantityToRemove > currentQuantity) {
                    alert(`Cannot remove more than available quantity (${currentQuantity})`);
                    return;
                }
                
                // Update tool quantity or delete if all are removed
                if (quantityToRemove === currentQuantity) {
                    // Mark as damaged or lost instead of deleting
                    tools[toolIndex].status = reason;
                    tools[toolIndex].lastUpdated = new Date().toISOString().split('T')[0];
                } else {
                    tools[toolIndex].quantity = currentQuantity - quantityToRemove;
                    tools[toolIndex].lastUpdated = new Date().toISOString().split('T')[0];
                }
                
                // Record the removal in the appropriate collection
                const removalData = {
                    toolId: toolId,
                    toolName: toolData.name,
                    quantity: quantityToRemove,
                    date: removeDate,
                    reason: reason,
                    notes: notes,
                    removedAt: new Date().toISOString()
                };
                
                if (reason === 'damage') {
                    damagedItems.push(removalData);
                    localStorage.setItem('damagedItems', JSON.stringify(damagedItems));
                } else if (reason === 'loss') {
                    lostItems.push(removalData);
                    localStorage.setItem('lostItems', JSON.stringify(lostItems));
                }
                
                // Save to localStorage
                localStorage.setItem('tools', JSON.stringify(tools));
                
                alert('Tool removed successfully!');
                removeToolModal.style.display = 'none';
                loadTools();
            } catch (error) {
                console.error('Error removing tool:', error);
                alert('Failed to remove tool. Please try again.');
            }
        });

        // Filter tools based on search and filters
        function filterTools() {
            const searchTerm = document.getElementById('tool-search').value.toLowerCase();
            const statusFilter = document.getElementById('status-filter').value;
            const categoryFilter = document.getElementById('category-filter').value;
            
            const filteredTools = tools.filter(tool => {
                const matchesSearch = tool.name.toLowerCase().includes(searchTerm) ||
                                    tool.id.toLowerCase().includes(searchTerm) ||
                                    (tool.size && tool.size.toLowerCase().includes(searchTerm)) ||
                                    (tool.category && tool.category.toLowerCase().includes(searchTerm));
                
                const matchesStatus = statusFilter === 'all' || tool.status === statusFilter;
                const matchesCategory = categoryFilter === 'all' || tool.category === categoryFilter;
                
                return matchesSearch && matchesStatus && matchesCategory;
            });
            
            renderTools(filteredTools);
        }

        function renderTools(toolsToRender) {
            toolsList.innerHTML = '';
            
            if (toolsToRender.length === 0) {
                toolsList.innerHTML = '<div class="tool-card"><p>No tools found matching your criteria.</p></div>';
                return;
            }
            
            toolsToRender.forEach(tool => {
                const toolCard = document.createElement('div');
                toolCard.className = 'tool-card';
                toolCard.innerHTML = `
                    <div class="tool-header">
                        <div class="tool-title">${tool.name} ${tool.size ? `(${tool.size})` : ''}</div>
                        <div class="tool-status status-${tool.status}">${tool.status.charAt(0).toUpperCase() + tool.status.slice(1)}</div>
                    </div>
                    <div class="tool-details">
                        <div class="tool-detail">
                            <span class="detail-label">Category</span>
                            <span class="detail-value">${formatCategory(tool.category)}</span>
                        </div>
                        <div class="tool-detail">
                            <span class="detail-label">Quantity</span>
                            <span class="detail-value">${tool.quantity}</span>
                        </div>
                        <div class="tool-detail">
                            <span class="detail-label">Condition</span>
                            <span class="detail-value">${tool.condition ? formatCondition(tool.condition) : 'Good'}</span>
                        </div>
                        <div class="tool-detail">
                            <span class="detail-label">Location</span>
                            <span class="detail-value">${tool.location || 'Not specified'}</span>
                        </div>
                    </div>
                    ${tool.notes ? `<p><strong>Notes:</strong> ${tool.notes}</p>` : ''}
                    <div class="tool-actions">
                        <button class="btn btn-primary btn-sm edit-tool" data-id="${tool.id}">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-danger btn-sm remove-tool-btn" data-id="${tool.id}" data-name="${tool.name}" data-quantity="${tool.quantity}">
                            <i class="fas fa-minus-circle"></i> Remove
                        </button>
                    </div>
                `;
                
                toolsList.appendChild(toolCard);
            });
            
            // Add event listeners to tool action buttons
            document.querySelectorAll('.edit-tool').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const toolId = e.target.closest('button').dataset.id;
                    editTool(toolId);
                });
            });
            
            document.querySelectorAll('.remove-tool-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const toolId = e.target.closest('button').dataset.id;
                    const toolName = e.target.closest('button').dataset.name;
                    const toolQuantity = e.target.closest('button').dataset.quantity;
                    openRemoveToolModal(toolId, toolName, toolQuantity);
                });
            });
        }

        function loadTools() {
            try {
                filterTools(); // This will render the tools with current filters
            } catch (error) {
                console.error('Error loading tools:', error);
                toolsList.innerHTML = '<div class="tool-card"><p>Error loading tools. Please try again.</p></div>';
            }
        }

        async function editTool(toolId) {
            try {
                const tool = tools.find(t => t.id === toolId);
                
                if (!tool) {
                    alert('Tool not found');
                    return;
                }
                
                document.getElementById('tool-modal-title').textContent = 'Edit Tool';
                document.getElementById('tool-id').value = toolId;
                document.getElementById('tool-name').value = tool.name;
                document.getElementById('tool-size').value = tool.size || '';
                document.getElementById('tool-category').value = tool.category;
                document.getElementById('tool-quantity').value = tool.quantity;
                document.getElementById('tool-status').value = tool.status;
                document.getElementById('tool-date').value = tool.date || '';
                document.getElementById('tool-location').value = tool.location || '';
                document.getElementById('tool-condition').value = tool.condition || 'good';
                document.getElementById('tool-notes').value = tool.notes || '';
                
                toolModal.style.display = 'flex';
            } catch (error) {
                console.error('Error loading tool for editing:', error);
                alert('Failed to load tool details. Please try again.');
            }
        }

        function openRemoveToolModal(toolId, toolName, maxQuantity) {
            document.getElementById('remove-tool-id').value = toolId;
            document.getElementById('remove-tool-name').value = toolName;
            document.getElementById('remove-tool-quantity').value = 1;
            document.getElementById('remove-tool-quantity').max = maxQuantity;
            document.getElementById('remove-date').valueAsDate = new Date();
            document.getElementById('remove-notes').value = '';
            
            // Reset radio buttons
            document.querySelectorAll('input[name="removal-reason"]').forEach(radio => {
                radio.checked = false;
            });
            
            removeToolModal.style.display = 'flex';
        }

        function formatCategory(category) {
            const categories = {
                'hand-tools': 'Hand Tools',
                'power-tools': 'Power Tools',
                'safety-equipment': 'Safety Equipment',
                'measuring-tools': 'Measuring Tools',
                'lubricants': 'Grease/Lubricants',
                'other': 'Other'
            };
            
            return categories[category] || category;
        }

        function formatCondition(condition) {
            const conditions = {
                'excellent': 'Excellent',
                'good': 'Good',
                'fair': 'Fair',
                'poor': 'Poor'
            };
            
            return conditions[condition] || condition;
        }

        // Helper Functions
        async function updateInventory(itemName, quantityChange) {
            try {
                // Find the item in inventory
                const itemIndex = inventory.findIndex(item => item.name === itemName);
                
                if (itemIndex === -1) {
                    console.warn(`Item "${itemName}" not found in inventory. Creating new entry.`);
                    
                    // Create new inventory item with initial quantity
                    inventory.push({
                        name: itemName,
                        quantity: quantityChange > 0 ? quantityChange : 0,
                        lastUpdated: new Date().toISOString().split('T')[0],
                        createdAt: new Date().toISOString()
                    });
                    
                    localStorage.setItem('inventory', JSON.stringify(inventory));
                    return;
                }
                
                // Update existing inventory item
                const currentQuantity = inventory[itemIndex].quantity;
                const newQuantity = currentQuantity + quantityChange;
                
                if (newQuantity < 0) {
                    console.warn(`Inventory quantity for "${itemName}" would go negative. Setting to 0.`);
                    inventory[itemIndex].quantity = 0;
                } else {
                    inventory[itemIndex].quantity = newQuantity;
                }
                
                inventory[itemIndex].lastUpdated = new Date().toISOString().split('T')[0];
                
                localStorage.setItem('inventory', JSON.stringify(inventory));
            } catch (error) {
                console.error('Error updating inventory:', error);
                throw error;
            }
        }

        function loadDashboardData() {
            try {
                // Count active jobs (issued but not fully returned)
                const activeJobs = issuedItems.filter(item => item.status === 'issued');
                document.getElementById('active-jobs-count').textContent = activeJobs.length;
                
                // Count returned items today
                const today = new Date().toISOString().split('T')[0];
                const returnedToday = returnedItems.filter(item => item.date === today);
                
                let returnedItemsCount = 0;
                returnedToday.forEach(item => {
                    returnedItemsCount += item.items.length;
                });
                
                document.getElementById('returned-items-count').textContent = returnedItemsCount;
                
                // Count recent activities (transactions today)
                const issuedToday = issuedItems.filter(item => item.date === today);
                document.getElementById('recent-activities-count').textContent = 
                    issuedToday.length + returnedToday.length;
                
                // Load recent transactions (last 10)
                const recentTransactions = issuedItems.slice(-10).reverse();
                const transactionsTable = document.getElementById('recent-transactions');
                transactionsTable.innerHTML = '';
                
                if (recentTransactions.length === 0) {
                    transactionsTable.innerHTML = '<tr><td colspan="6" style="text-align: center;">No recent transactions</td></tr>';
                } else {
                    recentTransactions.forEach(data => {
                        const firstItem = data.items[0];
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${data.jobId}</td>
                            <td>${firstItem.name}${data.items.length > 1 ? ` +${data.items.length - 1} more` : ''}</td>
                            <td>${firstItem.quantity}</td>
                            <td>${data.issuedTo}</td>
                            <td>${data.date}</td>
                            <td><span class="status-badge ${data.status}">${data.status}</span></td>
                        `;
                        
                        // Add click event to view all items
                        row.style.cursor = 'pointer';
                        row.addEventListener('click', () => {
                            openViewItemsModal(data);
                        });
                        
                        transactionsTable.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        function loadIssuedItems() {
            try {
                const issuedItemsTable = document.getElementById('issued-items-table');
                issuedItemsTable.innerHTML = '';
                
                if (issuedItems.length === 0) {
                    issuedItemsTable.innerHTML = '<tr><td colspan="7" style="text-align: center;">No issued items</td></tr>';
                } else {
                    issuedItems.forEach(data => {
                        const firstItem = data.items[0];
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${data.jobId}</td>
                            <td>${data.issuedTo}</td>
                            <td>${data.purpose}</td>
                            <td>${data.date}</td>
                            <td>${firstItem.name} (${firstItem.quantity}${firstItem.unit ? ' ' + firstItem.unit : ''})${data.items.length > 1 ? ` +${data.items.length - 1} more` : ''}</td>
                            <td><span class 'status-badge ${data.status}'>${data.status}</span></td>
                            <td>
                                <button class="btn btn-secondary view-items-btn" data-jobid="${data.jobId}" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                                    <i class="fas fa-eye"></i> View
                                </button>
                            </td>
                        `;
                        
                        issuedItemsTable.appendChild(row);
                    });
                    
                    // Add event listeners to view buttons
                    document.querySelectorAll('.view-items-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const jobId = e.target.closest('button').dataset.jobid;
                            const issuedItem = issuedItems.find(item => item.jobId === jobId);
                            openViewItemsModal(issuedItem);
                        });
                    });
                }
            } catch (error) {
                console.error('Error loading issued items:', error);
            }
        }

        function loadReturnedItems() {
            try {
                const returnedItemsTable = document.getElementById('returned-items-table');
                returnedItemsTable.innerHTML = '';
                
                if (returnedItems.length === 0) {
                    returnedItemsTable.innerHTML = '<tr><td colspan="6" style="text-align: center;">No returned items</td></tr>';
                } else {
                    returnedItems.forEach(data => {
                        const firstItem = data.items[0];
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${data.returnId}</td>
                            <td>${data.jobId}</td>
                            <td>${data.date}</td>
                            <td>${firstItem.name} (${firstItem.returnedQuantity}${firstItem.unit ? ' ' + firstItem.unit : ''})${data.items.length > 1 ? ` +${data.items.length - 1} more` : ''}</td>
                            <td>${firstItem.condition || 'good'}</td>
                            <td>${data.notes || '-'}</td>
                        `;
                        
                        returnedItemsTable.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('Error loading returned items:', error);
            }
        }

        function openViewItemsModal(jobData) {
            document.getElementById('modal-job-id').textContent = jobData.jobId;
            document.getElementById('modal-issued-to').textContent = jobData.issuedTo;
            document.getElementById('modal-purpose').textContent = jobData.purpose;
            document.getElementById('modal-date').textContent = jobData.date;
            
            const itemsList = document.getElementById('modal-items-list');
            itemsList.innerHTML = '';
            
            jobData.items.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.quantity}</td>
                    <td>${item.unit || '-'}</td>
                `;
                itemsList.appendChild(row);
            });
            
            viewItemsModal.style.display = 'flex';
        }

        // Initialize date fields
        document.getElementById('issue-date').valueAsDate = new Date();
        document.getElementById('start-date').valueAsDate = new Date();
        document.getElementById('end-date').valueAsDate = new Date();
        document.getElementById('tool-date').valueAsDate = new Date();
        document.getElementById('remove-date').valueAsDate = new Date();
    </script>
</body>
</html>